/* $Id: init-espresso.S,v 1.3 2005/11/10 11:21:29 sturgesa Exp $
 *
 *  gdb-sh-stub/init-espresso.S
 */

#include "../../cpu/sh4_1xx/init-st40common.S"


	.balign 4
9:

! Program clock generator registers
	POKE_LONG(0xb9163090, 0x0000c0de)	! CKG_LOCK (unlocked)
	POKE_LONG(0xb9163024, 0x00000001)	! CPG_BYPASS
	POKE_LONG(0xb9163018, 0x00000002)	! CLOCKGEN_PLL1_CLK4_CTRL
	POKE_LONG(0xb9163040, 0xde40841a)	! CLOCKGEN_PLL2_CTRL (PLL 133MHz)
						! PLL setup procedure isn't equal to the procedure
						! described in the STi5528 hw manual but it works fine.
	POKE_LONG(0xb916308c, 0x0)		! CLOCKGEN_PWM_CLK_CTRL
	POKE_LONG(0xb9163080, 0x0)		! CLOCKGEN_AUD_CLK_REF_CTRL
	POKE_LONG(0xb9163058, 0x071901ed)	! CLOCKGEN_QSYNTH2_CLK2_CTRL
	POKE_LONG(0xb9163074, 0x1b)		! CLOCKGEN_ST20_TICK_CTRL
	POKE_LONG(0xb916307c, 0xb4b)		! CLOCKGEN_LP_CLK_CTRL
	POKE_LONG(0xb9163088, 0x0)		! CLOCKGEN_DVP_CLK_CTRL
	POKE_LONG(0xb9163090, 0x00000000)	! CKG_LOCK (locked)
! Program system configuration registers
	POKE_LONG(0xb9162058, 0x00000810)	! SYSCONF_SYS_CFG10
	POKE_LONG(0xb916205c, 0x000000ff)	! SYSCONF_SYS_CFG11
	POKE_LONG(0xb9162060, 0x00000005)	! SYSCONF_SYS_CFG12
	POKE_LONG(0xb9162064, 0x00000000)	! SYSCONF_SYS_CFG13
! Program Bank Addresses
	! Setting EMILOCK register to unlock the EMI registers
	POKE_LONG(0xba100020, 0x00000000)	! EMI_LOCK
	POKE_LONG(0xba100860, 0x00000006)	! EMI_BANK_ENABLE
	POKE_LONG(0xba100800, 0x00000000)	! EMI_BANK0_BASEADDRESS
	POKE_LONG(0xba100810, 0x00000004)	! EMI_BANK1_BASEADDRESS
	POKE_LONG(0xba100820, 0x00000008)	! EMI_BANK2_BASEADDRESS
	POKE_LONG(0xba100830, 0x00000009)	! EMI_BANK3_BASEADDRESS
	POKE_LONG(0xba100840, 0x0000000a)	! EMI_BANK4_BASEADDRESS
	POKE_LONG(0xba100850, 0x0000000e)	! EMI_BANK5_BASEADDRESS

! Program Bank Function 
	! Bank 0 - Boot Flash (16M)
	POKE_LONG(0xba100100, 0x001016e9)
	POKE_LONG(0xba100108, 0x9d200000)
	POKE_LONG(0xba100110, 0x9d220000)
	POKE_LONG(0xba100118, 0x00000000)
	! Bank 1 - Boot Flash (16Mb)
	POKE_LONG(0xba100140, 0x001016e9)
	POKE_LONG(0xba100148, 0x9d200000)
	POKE_LONG(0xba100150, 0x9d220000)
	POKE_LONG(0xba100158, 0x00000000)
	! Bank 2 - STV0701
	POKE_LONG(0xba100180, 0x021016f9)
	POKE_LONG(0xba100188, 0x9d200000)
	POKE_LONG(0xba100190, 0x9d220000)
	POKE_LONG(0xba100198, 0x00000000)
	! Bank 3 - STi4629
	POKE_LONG(0xba1001c0, 0x002046f9)
	POKE_LONG(0xba1001c8, 0xa5a00000)
	POKE_LONG(0xba1001d0, 0xa5a20000)
	POKE_LONG(0xba1001d8, 0x00000000)
	! Bank 4 - EMI Connector
	POKE_LONG(0xba100200, 0x021016e9)
	POKE_LONG(0xba100208, 0x9d200000)
	POKE_LONG(0xba100210, 0x9d220000)
	POKE_LONG(0xba100218, 0x00000000)
	! Bank 5 - LAN91C111
	POKE_LONG(0xba100240, 0x041086f1)
	POKE_LONG(0xba100248, 0x86001100)
	POKE_LONG(0xba100250, 0x86001100)
	POKE_LONG(0xba100258, 0x00000000)

! Program Other EMI Registers
	POKE_LONG(0xba100028, 0x00000680)	! EMI_GENCFG
	POKE_LONG(0xba100050, 0x00000002)	! EMI_FLASHCLKSEL
	POKE_LONG(0xba100068, 0x00000001)	! EMI_CLKENABLE
	POKE_LONG(0xba100058, 0x00000000)	! EMI_SDRAMCLKSEL
	POKE_LONG(0xba100030, 0x00000000)	! EMI_SDRAMNOPGEN
	POKE_LONG(0xba100048, 0x000003e8)	! EMI_REFRESHINIT
	POKE_LONG(0xba100038, 0x00000000)	! EMI_SDRAMMODEREG
	POKE_LONG(0xba100040, 0x00000000)	! EMI_SDRAMINIT

! LMI configuration

! LMI registers
	POKE_LONG(0xaf000008, 0x01000243)	! LMI_MIM   
	POKE_LONG(0xaf000018, 0x000c7b45)       ! LMI_STR (SDRAM Timing Register ## CAS 2.0)
	POKE_LONG(0xaf000030, 0x08001900)	! LMI_SDRA0 (SDRAM Row Attribute 0)
	POKE_LONG(0xaf000038, 0x0c001900)	! LMI_SDRA1 (SDRAM Row Attribute 1)

! Program LMI_SDRAM_CONTROL register
	POKE_LONG(0xaf000010, 0x00000001)	! LMI_SCR        
	POKE_LONG(0xaf000010, 0x00000003)	! LMI_SCR        
	POKE_LONG(0xaf000010, 0x00000001)	! LMI_SCR        
	POKE_LONG(0xaf000010, 0x00000002)	! LMI_SCR
	POKE_LONG(0xaf800000|0x00002000, 0)	! LMI_SDMR0 (EMRS to device ## Enable DLL)
	POKE_LONG(0xaf900000|0x00002000, 0)	! LMI_SDMR1 (EMRS to device ## Enable DLL)
	POKE_LONG(0xaf800000|0x00000998, 0)	! LMI_SDMR0 (MRS to device ## Reset DLL)
	POKE_LONG(0xaf900000|0x00000998, 0)	! LMI_SDMR1 (MRS to device ## Reset DLL)
	POKE_LONG(0xaf000010, 0x00000002)	! LMI_SCR (Pre-charge all)
	POKE_LONG(0xaf000010, 0x00000004)	! LMI_SCR (CBR)
	POKE_LONG(0xaf000010, 0x00000004)	! LMI_SCR (CBR)
	POKE_LONG(0xaf000010, 0x00000004)	! LMI_SCR (CBR)
	POKE_LONG(0xaf800000|0x00000198, 0)	! LMI_SDMR0 (MRS to device ## Normal)
	POKE_LONG(0xaf900000|0x00000198, 0)	! LMI_SDMR1 (MRS to device ## Normal)
	POKE_LONG(0xaf000010, 0x00000000)	! LMI_SCR (Normal operation)
! Program interconnect register
	POKE_LONG(0xb9150000, 0x00000007)       ! STI5528_GDP0_DISP_PRIORITY
	POKE_LONG(0xb9150004, 0x00000003)       ! STI5528_GDP0_LL_PRIORITY
	POKE_LONG(0xb9150008, 0x00000006)       ! STI5528_GDP1_DISP_PRIORITY
	POKE_LONG(0xb915000c, 0x00000002)       ! STI5528_GDP1_LL_PRIORITY
	POKE_LONG(0xb9150010, 0x00000005)       ! STI5528_GDP2_DISP_PRIORITY
	POKE_LONG(0xb9150014, 0x00000001)       ! STI5528_GDP2_LL_PRIORITY
	POKE_LONG(0xb9150018, 0x00000004)       ! STI5528_GDP3_DISP_PRIORITY
	POKE_LONG(0xb9150100, 0x00000005)       ! STI5528_DISP0_IC_LUMA_PRIORITY
	POKE_LONG(0xb9150104, 0x00000003)       ! STI5528_DISP0_IC_CHROMA_PRIORITY
	POKE_LONG(0xb9150108, 0x00000004)       ! STI5528_DISP1_IC_LUMA_PRIORITY
	POKE_LONG(0xb915010c, 0x00000002)       ! STI5528_DISP1_IC_CHROMA_PRIORITY
	POKE_LONG(0xb9150114, 0x00000001)       ! STI5528_DVP_IC_ANC_PRIORITY
	POKE_LONG(0xb9150400, 0x00000003)       ! STI5528_N04_EMI_PRIORITY
	POKE_LONG(0xb9150404, 0x00000005)       ! STI5528_N04_LMI_PRIORITY
	POKE_LONG(0xb9150408, 0x00000004)       ! STI5528_N05_EMI_PRIORITY
	POKE_LONG(0xb915040c, 0x00000006)       ! STI5528_N05_LMI_PRIORITY
	POKE_LONG(0xb9150410, 0x00000002)       ! STI5528_N06_PRIORITY
	POKE_LONG(0xb9150414, 0x00000001)       ! STI5528_N07_PRIORITY
	POKE_LONG(0xb9150500, 0x00000004)       ! STI5528_CPUPLUG_IC_PRIORITY
	POKE_LONG(0xb9150504, 0x00000003)       ! STI5528_ST20_IC_ID_PRIORITY
	POKE_LONG(0xb9150508, 0x00000006)       ! STI5528_N02_PRIORITY
	POKE_LONG(0xb915050c, 0x00000002)       ! STI5528_N03_PRIORITY
	POKE_LONG(0xb9150514, 0x00000005)       ! STI5528_N08_LMI_PRIORITY
	POKE_LONG(0xb9150518, 0x00000001)       ! STI5528_N09_PRIORITY
	POKE_LONG(0xb915051c, 0x00000000)       ! STI5528_CPUPLUG_IC_LATENCY
	POKE_LONG(0xb9150520, 0x00000000)       ! STI5528_ST20_IC_ID_LATENCY
	POKE_LONG(0xb9150528, 0x00000000)       ! STI5528_N03_LATENCY
	POKE_LONG(0xb9150530, 0x00000000)       ! STI5528_N08_LMI_LATENCY
	POKE_LONG(0xb9150534, 0x00000000)       ! STI5528_N09_LATENCY
! Program CCN_CCR register
	POKE_LONG(0xff00001c, 0x0000090b)	! CCN_CCR
	
	END_MARKER
19:
